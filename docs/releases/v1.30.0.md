# Kubernetes Fury Distribution Release v1.30.0

Welcome to KFD release `v1.30.0`.

The distribution is maintained with ‚ù§Ô∏è by the team [SIGHUP](https://sighup.io/) it is battle tested in production environments.

## New Features since `v1.29.4`

### Installer Updates

- [on-premises](https://github.com/sighupio/fury-kubernetes-on-premises) üì¶ installer: [**v1.30.6**](https://github.com/sighupio/fury-kubernetes-on-premises/releases/tag/v1.30.6)
  - Updated etcd default version to 3.5.15
  - Updated HAProxy version to 3.0
  - Updated containerd default version to 1.7.23
  - Added support for Kubernetes versions 1.30.6, 1.29.10 and 1.28.15
- [eks](https://github.com/sighupio/fury-eks-installer) üì¶ installer: [**v3.2.0**](https://github.com/sighupio/fury-eks-installer/releases/tag/v3.2.0)
  - Introduced AMI selection type: `alinux2023` and `alinux2`
  - Fixed eks-managed nodepool node labels

### Module updates

- [networking](https://github.com/sighupio/fury-kubernetes-networking) üì¶ core module: [**v2.0.0**](https://github.com/sighupio/fury-kubernetes-networking/releases/tag/v2.0.0)
  - Updated Tigera operator to v1.36.1 (that includes calico v3.29.0)
  - Updated Cilium to v1.16.3
- [monitoring](https://github.com/sighupio/fury-kubernetes-monitoring) üì¶ core module: [**v3.3.0**](https://github.com/sighupio/fury-kubernetes-monitoring/releases/tag/v3.3.0)
  - Updated blackbox-exporter to v0.25.0
  - Updated grafana to v11.3.0
  - Updated kube-rbac-proxy to v0.18.1
  - Updated kube-state-metrics to v2.13.0
  - Updated node-exporter to v1.8.2
  - Updated prometheus-adapter to v0.12.0
  - Updated prometheus-operator to v0.76.2
  - Updated prometheus to v2.54.1
  - Updated x509-exporter to v3.17.0
  - Updated mimir to v2.14.0
  - Updated minio to version RELEASE.2024-10-13T13-34-11Z
- [logging](https://github.com/sighupio/fury-kubernetes-logging) üì¶ core module: [**v4.0.0**](https://github.com/sighupio/fury-kubernetes-logging/releases/tag/v4.0.0)
  - Updated opensearch and opensearch-dashboards to v2.17.1
  - Updated logging-operator to v4.10.0
  - Updated loki to v2.9.10
  - Updated minio to version RELEASE.2024-10-13T13-34-11Z
- [ingress](https://github.com/sighupio/fury-kubernetes-ingress) üì¶ core module: [**v3.0.1**](https://github.com/sighupio/fury-kubernetes-ingress/releases/tag/v3.0.1)
  - Updated cert-manager to v1.16.1
  - Updated external-dns to v0.15.0
  - Updated forecastle to v1.0.145
  - Updated nginx to v1.11.3
- [auth](https://github.com/sighupio/fury-kubernetes-auth) üì¶ core module: [**v0.4.0**](https://github.com/sighupio/fury-kubernetes-auth/releases/tag/v0.4.0)
  - Updated dex to v2.41.1
  - Updated pomerium to v0.27.1
- [dr](https://github.com/sighupio/fury-kubernetes-dr) üì¶ core module: [**v3.0.0**](https://github.com/sighupio/fury-kubernetes-dr/releases/tag/v3.0.0)
  - Updated velero to v1.15.0
  - Updated all velero plugins to v1.11.0
  - Added snapshot-controller v8.0.1
- [tracing](https://github.com/sighupio/fury-kubernetes-tracing) üì¶ core module: [**v1.1.0**](https://github.com/sighupio/fury-kubernetes-tracing/releases/tag/v1.1.0)
  - Updated tempo to v2.6.0
  - Updated minio to version RELEASE.2024-10-13T13-34-11Z
- [aws](https://github.com/sighupio/fury-kubernetes-aws) üì¶ module: [**v4.3.0**](https://github.com/sighupio/fury-kubernetes-aws/releases/tag/v4.3.0)
  - Updated cluster-autoscaler to v1.30.0
  - Updated snapshot-controller to v8.1.0
  - Updated aws-load-balancer-controller to v2.10.0
  - Updated node-termination-handler to v1.22.0

## New features üåü

- **New option for Logging**: The Loki configuration has been extended to accommodate the new `tsdbStartDate` option to allow a migration towards TSDB and schema v13 (note: **this is a breaking change**):

  ```yaml
  ...
    loki:
      tsdbStartDate: "2024-11-18"
  ...
  ```

  - `tsdbStartDate`  (**required**): configures details for the schema config for the purpose of the migration

  `tsdbStartDate` should be a string in `ISO 8601` date format and it represents the day starting from which Loki will record logs with the new store and schema.

  ‚ÑπÔ∏è **Note**:  Loki will assume the start of the day on the UTC midnight of the specified day.

- **DR improved configurable schedules**: The schedule configuration has been updated to enhance the usability of schedule customization (note: **this is a breaking change**):
  ```yaml
  ...
    dr:
      velero:
        schedules:
          install: true
          definitions:
            manifests:
              schedule: "*/15 * * * *"
              ttl: "720h0m0s"
            full:
              schedule: "0 1 * * *"
              ttl: "720h0m0s"
              snapshotMoveData: false
  ...
  ```
- **DR snapshotMoveData options for full schedule**: A new parameter has been introduced in the velero `full` schedule to enable the snapshotMoveData feature. This feature allows data captured from a snapshot to be copied to the object storage location. Important: Enabling this parameter will cause Velero to upload all data from the snapshotted volumes to S3 using Kopia. While backups are deduplicated, significant storage usage is still expected. To enable this parameter in the full schedule:
  ```yaml
  ...
    dr:
      velero:
        schedules:
          install: true
          definitions:
            full:
              snapshotMoveData: false
  ...
  ```
General example to enable Volume Snapshotting on rook-ceph (from our storage add-on module):
  ```yaml
  apiVersion: snapshot.storage.k8s.io/v1
  kind: VolumeSnapshotClass
  metadata:
  name: velero-snapclass
  labels:
    velero.io/csi-volumesnapshot-class: "true"
  driver: rook-ceph.rbd.csi.ceph.com
  parameters:
    clusterID: rook-ceph
    csi.storage.k8s.io/snapshotter-secret-name: rook-csi-rbd-provisioner
    csi.storage.k8s.io/snapshotter-secret-namespace: rook-ceph
  deletionPolicy: Retain
  ```
`deletionPolicy: Retain` is important because if the volume snapshot is deleted from the namespace, the cluster wide volumesnapshotcontent CR will be preserved, maintaining the snapshot on the storage that the cluster is using.
**NOTE**: For EKSCluster provider, a default VolumeSnapshotClass is created automatically.

- **DR optional snapshot-controller installation**: To leverage VolumeSnapshots on the OnPremises and KFDDistribution providers, a new option on velero has been added to install the snapshot-controller component. Before activating this parameter make sure that in your cluster there is not another snapshot-controller component deployed. By default this parameter is `false`.
  ```yaml
  ...
    dr:
      velero:
        snapshotController:
          install: true
  ...
  ```

## Fixes üêû

- **TBD**: TBD.

## Breaking changes üíî

- **Loki store and schema change:** A new store and schema has been introduced in order to improve efficiency, speed and scalability of Loki clusters.
- **DR Schema change**: A new format for the schedule customization has been introduced to improve the usability. See New Features section for more informations.

## Upgrade procedure

Check the [upgrade docs](https://github.com/sighupio/furyctl/tree/main/docs/upgrades/kfd/README.md) for the detailed procedure.
